generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Request {
  id   String @id @default(uuid())
  link String

  @@map("requests")
}

model Entity {
  id         String       @id @default(uuid())
  Media      Media[]
  Collection Collection[]
  EntityTag  EntityTag[]

  @@map("entities")
}

model Tag {
  id        String      @id @default(uuid())
  name      String      @unique
  EntityTag EntityTag[]

  @@map("tags")
}

model EntityTag {
  entity   Entity @relation(fields: [entityId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  entityId String @map("entity_id")
  tag      Tag    @relation(fields: [tagId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  tagId    String @map("tag_id")

  @@unique([entityId, tagId])
  @@map("entity_tags")
}

model CollectionMedia {
  id           String     @id @default(uuid())
  collection   Collection @relation(fields: [collectionId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  collectionId String     @map("collection_id")
  media        Media      @relation(fields: [mediaId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  mediaId      String     @map("media_id")
  order        Int

  @@map("collection_media")
}

model Collection {
  id              String            @id @default(uuid())
  entity          Entity            @relation(fields: [entityId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  entityId        String            @map("entity_id")
  title           String            @unique
  type            String
  author          String?
  createdAt       DateTime          @default(now()) @map("created_at")
  updatedAt       DateTime          @default(now()) @map("updated_at")
  CollectionMedia CollectionMedia[]

  @@map("collections")
}

model Media {
  id              String            @id @default(uuid())
  entity          Entity            @relation(fields: [entityId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  entityId        String            @map("entity_id")
  fileName        String            @unique @map("file_name")
  link            String
  type            String
  title           String            @default("")
  author          String?
  originalLink    String?
  previewId       String?           @unique
  createdAt       DateTime          @default(now()) @map("created_at")
  updatedAt       DateTime          @default(now()) @map("updated_at")
  CollectionMedia CollectionMedia[]
  Video           Media?            @relation("displayImage", fields: [previewId], references: [id])
  Photo           Media?            @relation("displayImage")

  @@map("medias")
}

model StorageSetting {
  version BigInt  @id @default(autoincrement()) @db.BigInt
  baseUrl String  @map("base_url")
  current Boolean @default(false)

  @@map("storage_settings")
}
